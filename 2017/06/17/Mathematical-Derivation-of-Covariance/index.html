<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="mathematics,covariance," />





  <link rel="alternate" href="/atom.xml" title="Isaac Changhau" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/tltimg.jpg?v=5.1.1" />






<meta name="description" content="In probability theory and statistics, covariance is a measure of the joint variability of two random variables. If the greater values of one variable mainly correspond with the greater values of the o">
<meta name="keywords" content="mathematics,covariance">
<meta property="og:type" content="article">
<meta property="og:title" content="Mathematical Derivation of Covariance Matrix">
<meta property="og:url" content="https://isaacchanghau.github.io/2017/06/17/Mathematical-Derivation-of-Covariance/index.html">
<meta property="og:site_name" content="Isaac Changhau">
<meta property="og:description" content="In probability theory and statistics, covariance is a measure of the joint variability of two random variables. If the greater values of one variable mainly correspond with the greater values of the o">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-09-21T08:53:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mathematical Derivation of Covariance Matrix">
<meta name="twitter:description" content="In probability theory and statistics, covariance is a measure of the joint variability of two random variables. If the greater values of one variable mainly correspond with the greater values of the o">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":true,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://isaacchanghau.github.io/2017/06/17/Mathematical-Derivation-of-Covariance/"/>





  <title>Mathematical Derivation of Covariance Matrix | Isaac Changhau</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>
    
    <!--<a href="https://github.com/IsaacChanghau"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>-->

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Isaac Changhau</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Stay Hungry, Stay Foolish</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th-list"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-vcard"></i> <br />
            
            About
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://isaacchanghau.github.io/2017/06/17/Mathematical-Derivation-of-Covariance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Isaac Changhau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Isaac Changhau">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Mathematical Derivation of Covariance Matrix</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-17T18:34:16+08:00">
                2017-06-17
              </time>
            

            
              <span class="post-updated">
                &nbsp; | &nbsp; <i class="fa fa-calendar-check-o"></i> Updated on
                <time itemprop="dateUpdated" datetime="2017-09-21T16:53:16+08:00" content="2017-09-21">
                  2017-09-21
                </time>
              </span>
            

            

            
          </span>

          
            <span class="post-letters-count">
              &nbsp; | &nbsp;
              <i class="fa fa-file-word-o"></i>
            <span>Count 2,538 words</span>
              <!--&nbsp; | &nbsp;
              <i class="fa fa-clock-o"></i>
            <span>Reading 16 min</span>-->
            </span>
          

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mathematics/" itemprop="url" rel="index">
                    <span itemprop="name">Mathematics</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>In probability theory and statistics, <a href="https://en.wikipedia.org/wiki/Covariance" target="_blank" rel="noopener">covariance</a> is a measure of the joint variability of two random variables. If the greater values of one variable mainly correspond with the greater values of the other variable, and the same holds for the lesser values, i.e., the variables<a id="more"></a> tend to show similar behavior, the covariance is positive. In the opposite case, when the greater values of one variable mainly correspond to the lesser values of the other, i.e., the variables tend to show opposite behavior, the covariance is negative. The sign of the covariance therefore shows the tendency in the linear relationship between the variables. While the normalized version of the covariance, the correlation coefficient, however, shows by its magnitude the strength of the linear relation.</p>
<h1 id="Notation-and-Definition"><a href="#Notation-and-Definition" class="headerlink" title="Notation and Definition"></a>Notation and Definition</h1><p>Suppose a set of random variables, $X_{1},X_{2},\dots,X_{n}$, where each random variable has $m$ samples, say, $X_{i}=(x_{i,1},\dots,x_{i,m})$, and denote $\mathbf{X}=(X_{1},X_{2},\dots,X_{n})^{T}$, thus, $\mathbf{X}$ is the random sample matrix:$$\mathbf{X}=\begin{bmatrix}<br>x_{1,1} &amp; x_{1,2} &amp; \dots &amp; x_{1,m} \\<br>x_{2,1} &amp; x_{2,2} &amp; \dots &amp; x_{2,m} \\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\<br>x_{n,1} &amp; x_{n,2} &amp; \dots &amp; x_{n,m}<br>\end{bmatrix}_{n\times m}\tag{1}$$where the elements in $i$-th row of $\mathbf{X}$, i.e., $x_{i,1},\dots,x_{i,m}$, represent the $m$ samples of $i$-th random variable $X_{i}$. Moreover, let’s denote$$\alpha_{i}:=(x_{i,1},x_{i,2},\dots,x_{i,m})^{T},i=1,2,\dots,n\tag{2}$$$$\beta_{j}:=(x_{1,j},x_{2,j},\dots,x_{n,j})^{T},j=1,2,\dots,m\tag{3}$$so, $\alpha_{i}$ represents the $i$-th <strong>row</strong> of $\mathbf{X}$, while $\beta_{j}$ corresponds to the $j$-th <strong>column</strong> of $\mathbf{X}$, then we will have:$$\mathbf{X}=(\beta_{1},\beta_{2},\dots,\beta_{m})=(\alpha_{1},\alpha_{2},\dots,\alpha_{n})^{T}\tag{4}$$Below gives some basic concepts which will be used to deduce the covariance matrix:<br><strong>Mathematical expectation</strong>, $E[\xi]$, is the summation or integration of a possible values from a random variable $\xi$. It is computed by the sum of the product of each posibale value $x_{i}$ and the probability $P(\xi=x_{i})$ of the value occurring.$$E[\xi]=\sum_{i}x_{i}P(\xi=x_{i})\tag{5}$$Here the mathematical expectation reflects the average of all possible values of the random variable. Simply, assuming all the possible values of $\xi$ are $x_{1},x_{2},\dots,x_{n}$, and they are equiprobable, i.e, $P(\xi=x_{i})=\frac{1}{n}$, $i=1,2,\dots,n$, then we have$$E[\xi]=\sum_{i=1}^{n}x_{i}P(\xi=x_{i})=\frac{1}{n}\sum_{i=1}^{n}x_{i}\tag{6}$$Besides, mathematical expectation operator is <strong>linear</strong> in the sense that$$E[a\xi+b\eta]=aE[\xi]+bE[\eta]\tag{7}$$and $\xi-E[\xi]$ is called <strong>dispersion</strong> of random variable $\xi$.<br><strong>Variance</strong>, denote as $D[\xi]$, or $var[\xi]$, is the expectation of the squared deviation of a random variable $\xi$ from its mean$$var[\xi]=E\big[(\xi-E[\xi])^{2}\big]\tag{8}$$It is non-negative, and informally measures how far a set of (random) numbers are spread out from their mean. Thus, the variance can be used to infer the rate of divergence of distribution of random varibale.<br><strong>Covariance</strong> is a measure of the joint variability of two random variables. Considering two random variables $X_{i}$ and $X_{j}$, their covariance is defined as$$cov(X_{i},X_{j})=E\big[(X_{i}-E[X_{i}])\centerdot(X_{j}-E[X_{j}])\big]\tag{9}$$and we have</p>
<ul>
<li>$cov(X_{i},X_{j})=cov(X_{j},X_{i})$</li>
<li>$cov(X_{i},X_{i})=var(X_{i})$</li>
</ul>
<p>Futher, accoding to the linearity of expectation, we have$$\begin{aligned}cov(X_{i},X_{j})<br>&amp; = E\big[(X_{i}-E[X_{i}])\centerdot(X_{j}-E[X_{j}])\big]\\<br>&amp; = E\big[X_{i}X_{j}-E[X_{j}]X_{i}-E[X_{i}]X_{j}+E[X_{i}]E[X_{j}]\big]\\<br>&amp; = E[X_{i}X_{j}]-E[X_{j}]E[X_{i}]-E[X_{i}]E[X_{j}]+E[X_{i}]E[X_{j}]\\<br>&amp; = E[X_{i}X_{j}]-E[X_{i}]E[X_{j}]\end{aligned}\tag{10}$$Thus, $cov(X_{i},X_{j})=E[X_{i}X_{j}]-E[X_{i}]E[X_{j}]$.<br><strong>Independence</strong>: If $X_{i}$ and $X_{j}$ are independent, then their covariance is zero. This follows because under independence, we have$$E[X_{i},X_{j}]=E[X_{i}]E[X_{j}]$$<strong>Coherence</strong>: assume that the random variables $X_{i}$ and $X_{j}$ santisfy $var[X_{i}]var[X_{j}]\neq 0$, then the correlation coefficient is defined as$$\rho_{X_{i},X_{j}}=\frac{cov[X_{i},X_{j}]}{\sqrt{var[X_{i}]}\centerdot\sqrt{var[X_{j}]}}\tag{11}$$if $\rho_{X_{i},X_{j}}=0$, $X_{i}$ and $X_{j}$ areuncorrelated, otherwise, they are correlated. Correlation coefficient, also named as linearly correlation coefficient, since the correlation coefficient describes the degree of “linear” relation between $X_{i}$ and $X_{j}$.<br>Meanwhile, it is worth to mention that for two random variables $X_{i}$ and $X_{j}$, $X_{i}$ and $X_{j}$ are independent is the sufficient but not necessary condition of uncorrelated, say, if $X_{i}$ and $X_{j}$ are independent, they must be uncorrelated, conversely, it does not always stand up. Thus, we can derive the relationship: <strong>independent</strong> $\Rightarrow$ <strong>uncorrelated</strong> $\Leftrightarrow$ $cov(X_{i},X_{j})=0$.<br>For a $n$ dimensional random variable $\mathbf{X}=(X_{1},X_{2},\dots,X_{n})^{T}$, its covariance matrix is defined as:$$C:=C(\mathbf{X})=(c_{i,j})_{n\times n}=\begin{bmatrix}<br>cov(X_{1},X_{1}) &amp; cov(X_{1},X_{2}) &amp; \dots &amp; cov(X_{1},X_{n}) \\<br>cov(X_{2},X_{1}) &amp; cov(X_{2},X_{2}) &amp; \dots &amp; cov(X_{2},X_{n}) \\<br>\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\<br>cov(X_{n},X_{1}) &amp; cov(X_{n},X_{2}) &amp; \dots &amp; cov(X_{n},X_{n})<br>\end{bmatrix}_{n\times n},\tag{12}$$where $c_{i,j}=cov(X_{i},X_{j})$, obviously, $C$ is a symmetric matrix, and its diagonal elements represent variance, non-diagonal elements represent the covariance among different components of $\mathbf{X}$. If the coherence of two components are small, then the corresponding value in $C$ is small either. Specifically, if all the components are uncorrelated with each other, $C$ becomes a diagonal matrix.<br>Note that, we cannot derive the actual value of $C(\mathbf{X})$, but approximately estimate its value according to the sample data provided in $\mathbf{X}$, which means the computed covariance matrix relys on the sample data, normally, the larger the sample data ($m$ is larger), the broader th coverage, and the covariance metrix is more reliable.</p>
<h1 id="Mathematical-Derivation"><a href="#Mathematical-Derivation" class="headerlink" title="Mathematical Derivation"></a>Mathematical Derivation</h1><p>According to (6), $E[X_{i}]$ and $E[X_{j}]$ can be approximately written as$$<br>E[X_{i}]=\frac{1}{m}\sum_{k=1}^{m}x_{i,k},\qquad<br>E[X_{j}]=\frac{1}{m}\sum_{k=1}^{m}x_{j,k}\tag{13}$$Let $Y=(X_{i}-E[X_{i}])\centerdot(X_{j}-E[X_{j}]):=(Y_{1},Y_{2},\dots,Y_{m})$, where $Y_{k}=(x_{i,k}-E[X_{i}])\centerdot(x_{j,k}-E[X_{j}])$, $k=1,2,\dots,m$, with (13), we can derive:$$\begin{aligned}c_{i,j}<br>&amp; =E[Y]=\frac{1}{m}\sum_{k=1}^{m}Y_{k}\\<br>&amp; =\frac{1}{m}\sum_{k=1}^{m}(x_{i,k}-E[X_{i}])\centerdot(x_{j,k}-E[X_{j}])\\<br>&amp; =\frac{1}{m}\sum_{k=1}^{m}\bigg[\big(x_{i,k}-\frac{1}{m}\sum_{p=1}^{m}x_{i,p}\big)\centerdot\big(x_{j,k}-\frac{1}{m}\sum_{q=1}^{m}x_{j,q}\big)\bigg]<br>\end{aligned}\tag{14}$$Then we need to simply the formula (14), as describe below:$$\begin{aligned}c_{i,j}<br>&amp; = \frac{1}{m}\sum_{k=1}^{m}\bigg[\big(x_{i,k}-\frac{1}{m}\sum_{p=1}^{m}x_{i,p}\big)\centerdot\big(x_{j,k}-\frac{1}{m}\sum_{q=1}^{m}x_{j,q}\big)\bigg]\\<br>&amp; = \frac{1}{m}\sum_{k=1}^{m}\bigg[x_{i,k}\centerdot x_{j,k}-x_{i,k}\centerdot\frac{1}{m}\sum_{q=1}^{m}x_{j,q}-x_{j,k}\centerdot\frac{1}{m}\sum_{p=1}^{m}x_{i,p}+\frac{1}{m}\sum_{p=1}^{m}x_{i,p}\centerdot\frac{1}{m}\sum_{q=1}^{m}x_{j,q}\bigg]\\<br>&amp; = \frac{1}{m}\sum_{k=1}^{m}x_{i,k}\centerdot x_{j,k}-\frac{1}{m}\sum_{k=1}^{m}x_{i,k}\centerdot\frac{1}{m}\sum_{q=1}^{m}x_{j,q}-\frac{1}{m}\sum_{k=1}^{m}x_{j,k}\centerdot\frac{1}{m}\sum_{p=1}^{m}x_{i,p}+\frac{1}{m}\sum_{k=1}^{m}\frac{1}{m}\sum_{p=1}^{m}x_{i,p}\centerdot\frac{1}{m}\sum_{q=1}^{m}x_{j,q}\\<br>&amp; =\frac{1}{m}\sum_{k=1}^{m}x_{i,k}\centerdot x_{j,k}-\frac{1}{m^{2}}\sum_{k=1}^{m}x_{i,k}\centerdot\sum_{k=1}^{m}x_{j,k}-\frac{1}{m^{2}}\sum_{k=1}^{m}x_{j,k}\centerdot\sum_{k=1}^{m}x_{i,k}+\frac{1}{m^{3}}\sum_{k=1}^{m}1\centerdot\sum_{p=1}^{m}x_{i,p}\centerdot\sum_{q=1}^{m}x_{j,q}\\<br>&amp; = \frac{1}{m}\sum_{k=1}^{m}x_{i,k}\centerdot x_{j,k}-\frac{1}{m^{2}}\big(\sum_{k=1}^{m}x_{i,k}\big)\centerdot\big(\sum_{k=1}^{m}x_{j,k}\big)-\frac{1}{m^{2}}\big(\sum_{k=1}^{m}x_{j,k}\big)\centerdot\big(\sum_{k=1}^{m}x_{i,k}\big)+\frac{1}{m^{2}}\big(\sum_{k=1}^{m}x_{i,k}\big)\centerdot\big(\sum_{k=1}^{m}x_{j,k}\big)\\<br>&amp; = \frac{1}{m}\sum_{k=1}^{m}x_{i,k}\centerdot x_{j,k}-\frac{1}{m^{2}}\big(\sum_{k=1}^{m}x_{i,k}\big)\centerdot\big(\sum_{k=1}^{m}x_{j,k}\big)\\<br>&amp; =\frac{1}{m}\alpha_{i}^{T}\alpha_{j}-\frac{1}{m^{2}}\big(\sum_{k=1}^{m}x_{i,k}\big)\centerdot\big(\sum_{k=1}^{m}x_{j,k}\big)<br>\end{aligned}\tag{15}$$Here we derive the representation of element $c_{i,j}$ in $C$, in order to obtain a more terse expression of $C$, we first introduce two temporary matrix $A$ and $B$, make $C=A-B$, and simply $A$ and $B$ seperately.<br>For matrix $A=(a_{i,j})_{n\times n}$, where$$a_{i,j}=\frac{1}{m}\alpha_{i}^{T}\alpha_{j}\tag{16}$$according to (4), we have$$\begin{aligned}A<br>&amp; =\frac{1}{m}\begin{pmatrix}\alpha_{1}^{T}\\\alpha_{2}^{T}\\\vdots\\\alpha_{n}^{T}\end{pmatrix}(\alpha_{1},\alpha_{2},\dots,\alpha_{n})\\<br>&amp; =\frac{1}{m}\mathbf{X}\mathbf{X}^{T}\\<br>&amp; =\frac{1}{m}(\beta_{1},\beta_{2},\dots,\beta_{m})(\beta_{1},\beta_{2},\dots,\beta_{m})^{T}\\<br>&amp; =\frac{1}{m}\sum_{i=1}^{m}\beta_{i}\beta_{i}^{T}<br>\end{aligned}\tag{17}$$Then for matrix $B=(b_{i,j})_{n\times n}$, where$$b_{i,j}=\frac{1}{m^{2}}\big(\sum_{k=1}^{m}x_{i,k}\big)\centerdot\big(\sum_{k=1}^{m}x_{j,k}\big)\tag{18}$$we have$$\begin{aligned}B<br>&amp; =\frac{1}{m^{2}}<br>\begin{pmatrix}\sum_{k=1}^{m}x_{1,k}\\<br>\sum_{k=1}^{m}x_{2,k}\\<br>\vdots\\<br>\sum_{k=1}^{m}x_{n,k}<br>\end{pmatrix}(\sum_{k=1}^{m}x_{1,k},\sum_{k=1}^{m}x_{2,k},\dots,\sum_{k=1}^{m}x_{n,k})\\<br>&amp; =\frac{1}{m^{2}}\big(\sum_{i=1}^{m}\beta_{i}\big)\big(\sum_{i=1}^{m}\beta_{i}\big)^{T}\end{aligned}\tag{19}$$Since we suppose that $C=A-B$, so according to (17) and(19), we can write $C$ as$$<br>C=\frac{1}{m}\sum_{i=1}^{m}\beta_{i}\beta_{i}^{T}<br>-\frac{1}{m^{2}}\big(\sum_{i=1}^{m}\beta_{i}\big)\big(\sum_{i=1}^{m}\beta_{i}\big)^{T}\tag{20}$$Actually, the formula (20) still can be simplified to merge the two terms as one term:$$\begin{aligned}C<br>&amp; =\frac{1}{m}\sum_{i=1}^{m}\beta_{i}\beta_{i}^{T}-\frac{1}{m^{2}}\big(\sum_{i=1}^{m}\beta_{i}\big)\big(\sum_{k=1}^{m}\beta_{k}\big)^{T}\\<br>&amp; =\frac{1}{m}\sum_{i=1}^{m}\beta_{i}\beta_{i}^{T}-\frac{1}{m^{2}}\big(\sum_{i=1}^{m}\beta_{i}\big)\big(\sum_{k=1}^{m}\beta_{k}\big)^{T}-\frac{1}{m^{2}}\big(\sum_{k=1}^{m}\beta_{k}\big)\big(\sum_{i=1}^{m}\beta_{i}\big)^{T}+\frac{1}{m^{2}}\big(\sum_{k=1}^{m}\beta_{k}\big)\big(\sum_{i=k}^{m}\beta_{k}\big)^{T}\\<br>&amp; =\frac{1}{m}\sum_{i=1}^{m}\beta_{i}\beta_{i}^{T}-\frac{1}{m^{2}}\big(\sum_{i=1}^{m}\beta_{i}\big)\big(\sum_{k=1}^{m}\beta_{k}\big)^{T}-\frac{1}{m^{2}}\big(\sum_{k=1}^{m}\beta_{k}\big)\big(\sum_{i=1}^{m}\beta_{i}\big)^{T}+\frac{1}{m^{3}}\sum_{i=1}^{m}\big(\sum_{k=1}^{m}\beta_{k}\big)\big(\sum_{i=k}^{m}\beta_{k}\big)^{T}\\<br>&amp; = \frac{1}{m}\bigg\{\beta_{i}\beta_{i}^{T}-\frac{1}{m}\beta_{i}\big(\sum_{k=1}^{m}\beta_{k}\big)^{T}-\frac{1}{m}\big(\sum_{k=1}^{m}\beta_{k}\big)\big(\beta_{i}^{T}\big)+\big(\frac{1}{m}\sum_{k=1}^{m}\beta_{k}\big)\big(\frac{1}{m}\sum_{i=k}^{m}\beta_{k}\big)^{T}\bigg\}\\<br>&amp; =\frac{1}{m}\sum_{i=1}^{m}\big(\beta_{i}-\frac{1}{m}\sum_{k=1}^{m}\beta_{k}\big)\big(\beta_{i}^{T}-\frac{1}{m}\sum_{k=1}^{m}\beta_{k}^{T}\big)\\<br>&amp; =\frac{1}{m}\sum_{i=1}^{m}\big(\beta_{i}-\beta_{0}\big)\big(\beta_{i}-\beta_{0}\big)^{T}<br>\end{aligned}\tag{21}$$where $\beta_{0}=\frac{1}{m}\sum_{k=1}^{m}\beta_{k}$, specifically, if the average of $m$ samples are zero for every random variable in $\mathbf{X}$, i.e., $\sum_{k=1}^{m}x_{i,k}=0$, then according to (18), we have $b_{i,j}=0$, further, $B=0$. In this case, we have $c_{i,j}=a_{i,j}=\frac{1}{m}\alpha_{i}^{T}\alpha_{j}$,$$C=A=\frac{1}{m}\sum_{i=1}^{m}\beta_{i}\beta_{i}^{T}=\frac{1}{m}\mathbf{X}\mathbf{X}^{T}\tag{22}$$This is the overall mathematical process to deduce the covariance matrix.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://en.wikipedia.org/wiki/Covariance" target="_blank" rel="noopener">Covariance</a></li>
<li><a href="https://en.wikipedia.org/wiki/Covariance_matrix" target="_blank" rel="noopener">Covariance Matrix</a></li>
<li><a href="http://www.statisticssolutions.com/directory-of-statistical-analyses-mathematical-expectation/" target="_blank" rel="noopener">Mathematical expectation</a></li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>Author:</strong>
      Isaac Changhau
    </li>
    <li class="post-copyright-link">
      <strong>Link:</strong>
      <a href="https://isaacchanghau.github.io/2017/06/17/Mathematical-Derivation-of-Covariance/" title="Mathematical Derivation of Covariance Matrix">https://isaacchanghau.github.io/2017/06/17/Mathematical-Derivation-of-Covariance/</a>
    </li>
    <li class="post-copyright-license">
      <strong>Notice: </strong>
      All articles are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally. Contact me via email for questions or discussion.
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/mathematics/" rel="tag"># mathematics</a>
          
            <a href="/tags/covariance/" rel="tag"># covariance</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/13/Understanding-LSTM-Networks/" rel="next" title="Understanding LSTM Networks [Reprinted]">
                <i class="fa fa-chevron-left"></i> Understanding LSTM Networks [Reprinted]
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/20/Install-XGBoost-on-Mac-OS-X/" rel="prev" title="Install XGBoost on Mac OS X">
                Install XGBoost on Mac OS X <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Isaac Changhau" />
          <p class="site-author-name" itemprop="name">Isaac Changhau</p>
           
              <p class="site-description motion-element" itemprop="description">Stay Hungry, Stay Foolish</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="mailto:isaac.changhau@gmail.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                  Email
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/isaac-changhau" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/IsaacChanghau" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Notation-and-Definition"><span class="nav-number">1.</span> <span class="nav-text">Notation and Definition</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mathematical-Derivation"><span class="nav-number">2.</span> <span class="nav-text">Mathematical Derivation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">3.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-star"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Isaac Changhau</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


        

        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->





  

  

  

  
  


  

  

</body>
</html>
